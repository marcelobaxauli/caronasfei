<!--
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix ="c" %>
-->
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" type="text/css">
  <link rel="stylesheet" href="https://pingendo.com/assets/bootstrap/bootstrap-4.0.0-beta.1.css" type="text/css">

<body>
  <nav class="navbar navbar-expand-md bg-primary navbar-dark">
    <div class="container">
      <a class="navbar-brand" href="../pingendo-page_index/index.html">CaronasFEI</a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbar2SupportedContent" aria-controls="navbar2SupportedContent" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button>
      <div class="collapse navbar-collapse text-center justify-content-end" id="navbar2SupportedContent">
        <ul class="navbar-nav"></ul>
      </div>
    </div>
  </nav>
  <form method="POST" action="${pageContext.request.contextPath}/registrar/primeiropasso/" id="form_dados_pessoais">
    <div class="py-4">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <h1 class="">Cadastro 1/3</h1>
          </div>
        </div>
      </div>
    </div>
    <div class="py-1">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <p class="lead">Dados pessoais</p>
          </div>
        </div>
      </div>
    </div>
    <div class="py-5">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="p-0">
              <p class="lead p-0">Nome: &nbsp;<span style="color: red">*</span></p>
              <input name="nome" type="text" class="form-control my-2" id="usr" required="true" data-format="hh:mm:ss"> </div>
          </div>
        </div>
      </div>
    </div>
    <div class="py-5">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="p-0">
              <p class="lead p-0">Foto:</p>
              <input name="foto" type="file" class="form-control my-2" accept="image/*" />
              </div>
          </div>
        </div>
      </div>
    </div>
    <div class="py-5">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="p-0">
              <p class="lead p-0">Email: &nbsp;<span style="color: red">*</span></p>
              <input name="email" required="true" type="email" class="form-control my-2" data-format="hh:mm:ss" id="usr" required="true"> </div>
          </div>
        </div>
      </div>
    </div>
    <div class="py-5">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="p-0">
              <p class="lead p-0">Celular: &nbsp;<span style="color: red">*</span></p>
              <input name="celular" type="text" class="form-control my-2" id="numero_celular"> </div>
          </div>
        </div>
      </div>
    </div>
    <div class="py-5">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="p-0">
              <p class="lead p-0">Curso: &nbsp;<span style="color: red">*</span></p>
              			<select name="curso" class="form-control" id="curso_select">

							<c:forEach var="curso" items="${cursos}">
	                           <option value="${curso.codigo}">${curso.nome}</option>
							</c:forEach>

                        </select> </div>
          </div>
        </div>
      </div>
    </div>
    <div class="py-5">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="p-0">
              <p class="lead p-0">Horário de aula:</p>
              <select name="periodo" class="form-control" id="periodo_select">
              	<c:forEach var="periodo" items="${periodos}">
              		<option value="${periodo.codigo}">${periodo.nome}</option>
              	</c:forEach>
              </select> </div>
          </div>
        </div>
      </div>
    </div>
    <div class="py-5">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="p-0">
              <p class="lead p-0">Cidade:</p>
              <input name="cidade" type="text" class="form-control my-2" id="usr" data-format="hh:mm:ss"> </div>
          </div>
        </div>
      </div>
    </div>
    <div class="py-5">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="p-0">
              <p class="lead p-0">Senha: &nbsp;<span style="color: red">*</span></p>
              <input name="senha" type="password" class="form-control my-2" id="senha" data-format="hh:mm:ss" required="true"> </div>
          </div>
        </div>
      </div>
    </div>
    <div class="py-5">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="p-0">
              <p class="lead p-0">Confirmar senha: &nbsp;<span style="color: red">*</span></p>
              <input type="password" class="form-control my-2" data-format="hh:mm:ss" id="senha_confirmacao" required="true"> </div>
          </div>
        </div>
      </div>
    </div>
    <div class="py-5">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <input type="submit" value="Enviar" class="btn btn-primary" id="submit_btn">
            <a class="btn mx-3 btn-danger" href="../pingendo-page_cadastro/index.html">Cancelar</a>
          </div>
        </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>
    <script>

    	$(document).ready(function() {

            $("#numero_celular").on("input", function(e) {

           		var previousValue = $("#numero_celular").val();
           		var lastChar = previousValue.charAt(previousValue.length - 1);
				console.log(lastChar);
           		if (!(lastChar >= '0' && lastChar <= '9') || ( (lastChar >= '0' && lastChar <= '9') &&  $("#numero_celular").val().length == 14) ) {
           			var lastCharIndex = $("#numero_celular").val().length - 1;
					$("#numero_celular").val($("#numero_celular").val().substr(0, lastCharIndex));

           		} else {
					if ($("#numero_celular").val().length == 2) {
						$("#numero_celular").val($("#numero_celular").val() + ' ');
					}

					if ($("#numero_celular").val().length > 8 && !$("#numero_celular").val().includes('-')) {
						$("#numero_celular").val($("#numero_celular").val().substr(0, 8) + '-' + $("#numero_celular").val().substr(8, $("#numero_celular").val().length));
					}
           		}



            });

           $("#senha_confirmacao").on("input", function(e) {

            	if ($("#senha").val() != $("#senha_confirmacao").val()) {

					document.getElementById("senha_confirmacao").setCustomValidity("Senha e confirmação nao conferem");

            	} else {

					document.getElementById("senha_confirmacao").setCustomValidity("");

            	}

            })

            $("#form_dados_pessoais").submit(function(event) {

				event.preventDefault();

				var formNome = $('#form_dados_pessoais').find('input[name="nome"]').val();
				var formEmail = $('#form_dados_pessoais').find('input[name="email"]').val();
				var formCelular = $('#form_dados_pessoais').find('input[name="celular"]').val();
				var formCurso = $('#curso_select').val();
				var formPeriodo = $('#periodo_select').val();
				var formCidade = $('#form_dados_pessoais').find('input[name="cidade"]').val();
				var formSenha = $('#form_dados_pessoais').find('input[name="senha"]').val();

				var novoUsuario = {};
				novoUsuario.nome = formNome;
				novoUsuario.email = formEmail;
				novoUsuario.celular = formCelular;
				novoUsuario.curso = formCurso;
				novoUsuario.periodo = formPeriodo ;
				novoUsuario.cidade = formCidade;
				novoUsuario.senha = formSenha;

				$.ajax({
					url: "${pageContext.request.contextPath}/registro/dadospessoais",
					type: "POST",
				    contentType: "application/json; charset=utf-8",
					data: JSON.stringify(novoUsuario),
					success: function(result, status, xhr) {

						console.log(result);
						console.log(status);
						console.log(xhr);

						if (result.sucesso) {

							var proximaUrl = result.proximaUrl;

							window.location = proximaUrl;

						}

					},
					error: function(jqXHR, textStatus, errorThrown) {

						alert("Erro de conexao: " + errorThrown);

					}
				})

            });

    	});


    </script>
  </form>
</body>

</html>
